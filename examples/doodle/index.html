<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>Meeting Schedule App</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="">
    <meta name="author" content="">

    <!-- Le styles -->
    <link href="assets/css/bootstrap.css" rel="stylesheet">
    <link href="doodle.css" rel="stylesheet">
    <style>
      body {
        padding-top: 60px; /* 60px to make the container go all the way to the bottom of the topbar */
      }
    </style>
    <link href="assets/css/bootstrap-responsive.css" rel="stylesheet">

    <!-- Le HTML5 shim, for IE6-8 support of HTML5 elements -->
    <!--[if lt IE 9]>
      <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    <!-- Le fav and touch icons -->
    <link rel="shortcut icon" href="assets/ico/favicon.ico">
    <link rel="apple-touch-icon-precomposed" sizes="114x114" href="assets/ico/apple-touch-icon-114-precomposed.png">
    <link rel="apple-touch-icon-precomposed" sizes="72x72" href="assets/ico/apple-touch-icon-72-precomposed.png">
    <link rel="apple-touch-icon-precomposed" href="assets/ico/apple-touch-icon-57-precomposed.png">
  </head>

  <body>

    <div class="navbar navbar-fixed-top">
      <div class="navbar-inner">
        <div class="container">
          <a class="brand" href="#">Doodle</a>
        </div>
      </div>
    </div>

    <div class="container-fluid">
     <div class="row-fluid">
      <div class="span1">
          Demo of how to implement a "Doodle"-like application in CloudBrowser
      </div>
      <div class="span10">
      <table>
          <thead>
              <tr><th width="25%"></th>
                  <!-- ko foreach: times -->
                  <th class="d-month container"
                              data-bind="text: moment(start).format('MMMM')"></th>
                  <!-- /ko -->
              </tr>
              <tr><th></th>
                  <!-- ko foreach: times -->
                  <th class="d-month container"
                      data-bind="text: moment(start).format('ddd DD')"></th>
                  <!-- /ko -->
              </tr>
              <tr><th></th>
                  <!-- ko foreach: times -->
                  <th class="container"
                      data-bind="text: moment(start).format('h:mma') + ' - ' + moment(start+duration).format('h:mma')"></th>
                  <!-- /ko -->
              </tr>
          </thead>
          <tbody data-bind="foreach: participants">
              <tr class="participant-row">
                  <td class="container">
                      <a class="close" data-bind="visible: !editing(), click: $parent.removeParticipant">&nbsp;Ã—&nbsp;</a>
                      <span data-bind="visible: !editing(), click: edit, text: name"></span>
                      <input data-bind="visible: editing, value: name, hasfocus: editing" type="text"></input>
                  </td>
                  <!-- ko foreach: available -->
                  <td class="container" style="text-align: center"
                          data-bind="text: $data.avail() == 0 ? '\u2716' : '\u2714', 
                          css: { 'alert-danger': $data.avail() == 0, 'alert-success': $data.avail() == 1 },
                          click: function toggleAvailability () { 
                              $data.avail(1 - $data.avail()); 
                          }"
                      >
                  </td>
                  <!-- /ko -->
              </tr>
          </tbody>
      </table>
      <button data-bind="click: addParticipant">New Participant</button>
     </div>
    </div>
    </div> <!-- /container -->

    <!-- Le javascript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
    <script src="assets/js/jquery.js"></script>
    <script src="assets/js/bootstrap.js"></script>
    <script src="assets/js/knockout-2.0.0.js"></script>
    <script src="assets/js/moment.min.js"></script>
    <script type="text/javascript">
        function edit() { this.editing(true); }
        function Participant(name, editing, available) {
            this.name = name;
            this.editing = new ko.observable(editing);
            this.available = new ko.observableArray();
            if (available != undefined) {
                for (var i = 0; i < available.length; i++)
                    this.available.push({ avail: new ko.observable(available[i]) });
            } else {
                for (var i = 0; i < appModel.times().length; i++)
                    this.available.push({ avail: new ko.observable(0) });
            }
        }

        var appModel = {
            times: new ko.observableArray([
                    { start: 1334678400000, duration: 7200000 },
                    { start: 1334754900000, duration: 7200000 },
                    { start: 1334774700000, duration: 7200000 },
                    { start: 1334927700000, duration: 7200000 },
                    { start: 1334904300000, duration: 7200000 }
                ]),
            participants: new ko.observableArray([
                new Participant("Ms. Busy", false, [0, 1, 0, 1, 1])
            ]),
            addParticipant : function () {
                appModel.participants.push(new Participant('New Participant', true)); 
            },
            removeParticipant : function (participant) {
                appModel.participants.remove(participant);
            }
        };
        ko.applyBindings(appModel);

        // if running in CloudBrowser, provide a JSON service to obtain current data
        if (typeof require == "function") {
            var http  = require('http');
            http.createServer(function (req, res) {
                try {
                    res.writeHead(200, {'Content-Type': 'application/json'});
                    res.end(ko.toJSON(appModel), 'utf-8');
                } catch (err) {
                    res.writeHead(500);
                    res.end('Internal Server Error: ' + err);
                }  
            }).listen(1337);
        }
    </script>
  </body>
</html>
